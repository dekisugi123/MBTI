<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MBTI Spotting Analyzer</title>
  <style>
    body { font-family: system-ui; max-width: 900px; margin: 40px auto; padding: 20px; line-height: 1.6; }
    h1, h3 { color: #1f2937; }
    #starters { background: #f3f4f6; padding: 20px; border-radius: 12px; }
    ol { padding-left: 25px; }
    #chat { height: 450px; overflow-y: scroll; border: 1px solid #d1d5db; padding: 20px; background: white; border-radius: 12px; margin: 20px 0; }
    .msg { margin: 15px 0; padding: 12px; border-left: 4px solid #3b82f6; background: #f8fafc; }
    .user-msg { border-left-color: #10b981; }
    .ai-msg { border-left-color: #8b5cf6; }
    input { width: 55%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; }
    button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 0 5px; }
    .analyze { background: #ef4444; color: white; }
    .analyze:hover { background: #dc2626; }
    .send { background: #3b82f6; color: white; }
    .send:hover { background: #2563eb; }
  </style>
</head>
<body>
  <h1>MBTI Spotting Analyzer (mbti-notes Exact)</h1>
  <p>Answer starters w/ life examples. AI spots leads → Rechecks full signs/NOT for suspects → Final type.</p>

  <div id="starters">
    <h3>Open-Ended Starters (Ex from life required):</h3>
    <ol>
      <li>Describe a decision where values/morals clashed w/ others. Ex?</li>
      <li>How do you handle new/unfamiliar situations? Ex of comfort/discomfort?</li>
      <li>Ex of analyzing problems: Precision or efficiency focus?</li>
      <li>Planning: Patterns/foresight or details/routines? Ex?</li>
      <li>Social: Read harmony or authentic self? Ex clash?</li>
    </ol>
  </div>

  <div id="chat"></div>
  <input id="input" placeholder="Answer starter or respond to probe...">
  <button class="send" onclick="sendMessage()">Send</button>
  <button class="analyze" onclick="finalizeType()">Finalize Type</button>

  <script>
    // Full mbti-notes Spotting Data Embedded
    const spottingData = {
      "Si": {
        domSigns: ["Feel at ease when sensory details match expectations", "Easily thrown by physical discomfort/new env", "Value past learning/experience", "Prefer procedures/proper conduct"],
        notDomSigns: ["Careless with details", "Dislikes procedure", "Averse to authority", "Embraces novelty/risk/big ideas/sudden change", "Dismisses past exp", "Impractical/unrealistic/speculative"],
        qs: ["Sensory details to liking/expectations? Ex of discomfort in unfamiliar w/ no prior knowledge?"]
      },
      "Se": {
        domSigns: ["Engage physical world directly", "Adapt to immediate opportunities", "Seek sensory stimulation/novelty"],
        notDomSigns: ["Avoid sensory overload", "Prefer abstract over concrete", "Detached from present"],
        qs: ["Seize present action? Ex adapting chaos?"]
      },
      "Ni": {
        domSigns: ["Converge on foresight/patterns", "Strategic long-term vision", "Insightful predictions"],
        notDomSigns: ["Scattered/divergent ideas", "No big picture", "Short-term reactive"],
        qs: ["Predict trends/insights? Ex vision guiding?"]
      },
      "Ne": {
        domSigns: ["Diverge possibilities/brainstorm", "Novelty/connections", "Flexible ideas"],
        notDomSigns: ["Rigid routines", "Fear change", "Narrow focus"],
        qs: ["Explore 'what if'? Ex novelty embrace?"]
      },
      "Ti": {
        domSigns: ["Precise inner logic/dissection", "Consistency/accuracy", "Question assumptions"],
        notDomSigns: ["Accept authority w/o critique", "Efficiency over truth"],
        qs: ["Dissect arguments for flaws? Ex precision?"]
      },
      "Te": {
        domSigns: ["Efficient systems/objective goals", "Organize for results", "Standards/measurables"],
        notDomSigns: ["Subjective theories", "Ignore practicality"],
        qs: ["Structure for efficiency? Ex plans/results?"]
      },
      "Fi": {
        domSigns: ["Inner morals/authenticity", "Personal values guide", "Empathize deeply self"],
        notDomSigns: ["Mirror group feelings", "Compromise core self"],
        qs: ["'Right for me' vs group? Ex value clash?"]
      },
      "Fe": {
        domSigns: ["Group harmony/read social cues", "Adapt for others", "Emotional connection"],
        notDomSigns: ["Detached/blunt", "Ignore feelings"],
        qs: ["Harmony priority? Ex read room?"]
      }
    };

    let messages = [{
      role: 'system',
      content: `MBTI spotter using ONLY spottingData JSON. Flow: 1. Starter answers → Spot leads (e.g., 'detail ex → Si'). 2. For EACH suspect dom: List ALL domSigns + qs w/ "life ex?". Probe ALL notDomSigns: "Match any? Ex → Exclude if yes". Score: "Dom: 4/4 signs yes, 0 notDom → Strong dom". Repeat for stack till confident. Finalize: Stack, evidence, dev. Concrete ex EVERY time. No vague.`
    }];

    async function sendMessage() {
      const input = document.getElementById('input').value.trim();
      if (!input) return;
      messages.push({role: 'user', content: input});
      addMessage('You', input);
      document.getElementById('input').value = '';
      await getAIResponse();
    }

    async function getAIResponse() {
      const chat = document.getElementById('chat');
      chat.innerHTML += '<div class="msg ai-msg"><strong>AI:</strong> Thinking...</div>';
      try {
        const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
          method: 'POST',
          headers: {'Authorization': `Bearer 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`, 'Content-Type': 'application/json'},
          body: JSON.stringify({
            model: 'llama-3.1-8b-instant',
            messages: messages,
            max_tokens: 800,
            temperature: 0.2  // Low for precision
          })
        });
        const data = await response.json();
        const reply = data.choices[0].message.content;
        messages.push({role: 'assistant', content: reply});
        document.querySelector('.ai-msg:last-child').innerHTML = `<strong>AI:</strong> ${reply.replace(/\n/g, '<br>')}`;
      } catch (e) {
        addMessage('Error', e.message);
      }
      chat.scrollTop = chat.scrollHeight;
    }

    function addMessage(sender, text) {
      const chat = document.getElementById('chat');
      const div = document.createElement('div');
      div.className = `msg ${sender === 'You' ? 'user-msg' : 'ai-msg'}`;
      div.innerHTML = `<strong>${sender}:</strong> ${text.replace(/\n/g, '<br>')}`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    async function finalizeType() {
      messages.push({role: 'user', content: 'Finalize type: Stack from all signs/ex, evidence, rule-outs, development.'});
      addMessage('You', 'Finalize Type');
      await getAIResponse();
    }
  </script>
</body>
</html>
